{% extends "FoodFinder/BaseSesion.html" %}
{% load static %}
{% block titulo %}Moderador{% endblock %}
{% block Encabezado %}
	<h1>Bienvenido</h1>
	<p>{{ hello.nombre }} - Moderador</p>
{% endblock %}
{% block ExtraStyle %}
<link href="{% static 'css/sesion-moderador.css' %}" rel="stylesheet">
{% endblock %}
{% block contenido %}
<div class="row">
	{% for message in messages %}
      <div class="alert {{ message.tags }} alert-dismissible" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        {{ message }}
      </div>
    {% endfor %}

	<div class="col-lg-6">
		<div>
			<h3> Denuncias Reportadas</h3><br>
			<div>
				<table id="tablaQuery" class="display table table-hover">
				    <thead>
				        <tr>
				            <th>Fecha</th>
				            <th>Comedor</th>
				            <th>Quejas y denuncias</th>
							<th></th>
				        </tr>
				    </thead>
				    <tbody>
				        {% for d in denuncias %}
				        	<tr>
				        		<td>{{ d.comedor }}</td>
				        		<td>{{ d.fecha_den }}</td>
				        		<td>{{ d.denuncia }}</td>
								<td><input type="checkbox" id="denunciaCheck" name="denunciaCheck" onClick="checkbox();" value="{{d.denuncia}}">
								</td>
							</tr>
				        {% endfor %}

				    </tbody>
				</table>
			</div>
		</div>
	</div>
	<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12" id="div_editar">
	    <form role="form" id="formCorreo" method="POST" action="{% url 'FoodFinder:moderador' %}">{%csrf_token%}
	        <div>
	            <h3>Enviar denuncia por comedor</h3>
	        </div>
			<div class="form-group">
				<label>De:</label>
				<input type="text" class="form-control" id="name" name="name" placeholder="Nombres" required>
			</div>
	        <div class="form-group">
				<label>Para:</label>
				<input id="email" type="hidden" name="correoAdmin" val="{{superAdmin.correo}}"/>
	            <label>{{superAdmin.correo}}</label>
	        </div>
	        <div class="form-group">
	            <label id="asunto">Asunto:</label>
				<input type="text" class="form-control" id="subject" name="subject" placeholder="Escoja un comedor" value="" required>
	        </div>
			<div class="form-group">
	            <label>Comedor:</label>
				<select class="form-control" id="comedor" name="comedor">
					{% for c in comedores %}
					<option value="{{ c.nombre }}">{{ c.nombre }}</option>
					{% endfor %}
				</select>
	        </div>
	        <div class="form-group">
	            <textarea class="form-control" rows="7" name="message" id="show" pattern=".{0,1000}">Se realizaron las siguientes denuncias: </textarea>
	        </div>
	        <button type="submit" id="botonCorreo" class="ntn btn-default center-block">Enviar</button>
	    </form>
	</div>
</div>
<div class="platillos-disp col-lg-5">
	<h3>Numero de Denuncias por Comedores</h3><br>
	<div id="piechart"></div>
</div>
{% endblock %}
{% block ExtraScript %}
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">
// Load google charts
google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(drawChart);

// Draw the chart and set the chart values
function drawChart() {
  var data = google.visualization.arrayToDataTable([
  ['Denuncias', 'Comedores'],
  {% for c,n in denunciasDic.items %}
  ['{{c}}',{{n}}],
  {% endfor %}
]);

  // Optional; add a title and set the width and height of the chart
  var options = {'width':500, 'height':400};

  // Display the chart inside the <div> element with id="piechart"
  var chart = new google.visualization.PieChart(document.getElementById('piechart'));
  chart.draw(data, options);
}

function checkbox(){

  var checkboxes = document.getElementsByName('denunciaCheck');
  var checkboxesChecked = [];
  // loop over them all
  for (var i=0; i<checkboxes.length; i++) {
     // And stick the checked ones onto an array...
     if (checkboxes[i].checked) {

        checkboxesChecked.push(checkboxes[i].value);
     }
  }
  checkboxesChecked.toString();
  var str=("" + checkboxesChecked).replace(/,/g, '\n')
  var str1="Se realizaron las siguientes denuncias:\n";
  document.getElementById("show").value = str1+str;

}

$('#comedor').change(function(){
    	$('#subject').val("Denuncias realizadas a "+$('#comedor option:selected').text());
	});
</script>

{% endblock %}
